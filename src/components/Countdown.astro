---
// No necesitamos calcular valores iniciales, SimplyCountdown se encarga de todo
---

<!-- Contenedor para SimplyCountdown (vacÃ­o, la librerÃ­a lo llenarÃ¡) -->
<section id="countdown-target" class="countdown-container"></section>

<div class="mensaje-final" id="mensaje-final" style="display: none;">
  <h2>ðŸŽ‰ Â¡Feliz AÃ±o Nuevo 2026! ðŸŽŠ</h2>
</div>

<style>
  .countdown-container {
    display: grid;
    place-content: center;
    grid-template-columns: repeat(1, 1fr);
    gap: 1.5rem;
    max-width: 80%;
    margin: 0 auto;
    padding: 2rem 1rem;

    @media (width >= 768px) {
        grid-template-columns: repeat(4, 1fr);
        gap: 2rem;
    }

    animation: fade-in-down 0.5s ease forwards;
  }

  /* Estilos personalizados para SimplyCountdown */
  .countdown-container :global(.simply-section) {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    min-width: 120px;
    transition: transform 0.3s ease;
    cursor: default;

    @media (width >= 768px) {
        min-width: 150px;
    }
  }

  .countdown-container :global(.simply-section:hover) {
    transform: scale(1.05);
  }

  .countdown-container :global(.simply-amount) {
    font-family: var(--primary-font);
    font-size: 4rem;
    font-weight: 700;
    color: var(--gold);
    line-height: 1;
    transition: color 0.3s ease;
    display: block;
    min-width: 3ch;
    text-align: center;

    @media (width >= 768px) {
        font-size: 5rem;
    }
  }

  .countdown-container :global(.simply-section:hover .simply-amount) {
    color: var(--gold-alt);
  }

  .countdown-container :global(.simply-word) {
    font-family: var(--secondary-font);
    font-size: 1rem;
    color: var(--text);
    opacity: 0.8;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    display: block;
    text-align: center;
    white-space: nowrap;
  }

  .mensaje-final {
    text-align: center;
    padding: 3rem 1rem;
  }

  .mensaje-final h2 {
    font-family: var(--primary-font);
    font-size: 2.5rem;
    color: var(--gold);
    animation: celebrar 1s ease-in-out infinite alternate;
  }

  @keyframes celebrar {
    from { transform: scale(1); }
    to { transform: scale(1.05); }
  }

  @media (prefers-reduced-motion: reduce) {
    .countdown-container :global(.simply-amount) {
      transition: none;
    }
    .mensaje-final h2 {
      animation: none;
    }
    .countdown-container :global(.simply-section:hover) {
      transform: none;
    }
  }
</style>

<script>
  import simplyCountdown from 'simplycountdown.js';

  function initCountdown() {
    const countdownElement = document.getElementById('countdown-target');
    
    if (!countdownElement) return;

    // Limpiar cualquier contenido previo (evita duplicados en navegaciones)
    countdownElement.innerHTML = '';

    // Obtener la fecha objetivo: 1 de enero del aÃ±o siguiente a las 00:00:00
    const currentYear = new Date().getFullYear();
    const nextYear = currentYear + 1;
    const targetDate = new Date(`${nextYear}-01-01T00:00:00+01:00`);

    // Inicializar SimplyCountdown
    simplyCountdown('#countdown-target', {
      year: targetDate.getFullYear(),
      month: targetDate.getMonth() + 1, // JavaScript months son 0-11, SimplyCountdown espera 1-12
      day: targetDate.getDate(),
      hours: 0,
      minutes: 0,
      seconds: 0,

      // Palabras en espaÃ±ol con pluralizaciÃ³n correcta
      words: {
        days: {
          lambda: (root: string, count: number) => count === 1 ? 'DÃ­a' : 'DÃ­as',
          root: 'DÃ­a'
        },
        hours: {
          lambda: (root: string, count: number) => count === 1 ? 'Hora' : 'Horas',
          root: 'Hora'
        },
        minutes: {
          lambda: (root: string, count: number) => count === 1 ? 'Minuto' : 'Minutos',
          root: 'Minuto'
        },
        seconds: {
          lambda: (root: string, count: number) => count === 1 ? 'Segundo' : 'Segundos',
          root: 'Segundo'
        }
      },

      // ConfiguraciÃ³n
      plural: true,
      inline: false,
      enableUtc: false, // Usamos hora local (CET/CEST)
      zeroPad: true, // Mostrar 01 en lugar de 1
      countUp: false,
      removeZeroUnits: false,
      refresh: 1000, // Actualizar cada segundo

      // Clases personalizadas (usar las por defecto)
      sectionClass: 'simply-section',
      amountClass: 'simply-amount',
      wordClass: 'simply-word',

      // Callback cuando termina el contador
      onEnd: () => {
        const mensajeFinal = document.getElementById('mensaje-final');
        const countdownContainer = document.getElementById('countdown-target');
        
        if (mensajeFinal && countdownContainer) {
          mensajeFinal.style.display = 'block';
          countdownContainer.remove();
        }
      }
    });
  }

  // Inicializar solo una vez al cargar
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCountdown);
  } else {
    initCountdown();
  }

  // Reinicializar despuÃ©s de navegaciones con View Transitions
  document.addEventListener('astro:page-load', initCountdown);
</script>